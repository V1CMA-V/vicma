---
import ContactCard from '@/components/freelance/ContactCard.astro'
import TextSections from '@/components/freelance/TextSections.astro'
---

<section
  id='contact'
  class='w-full max-w-6xl mx-auto py-24 px-4 md:px-8 flex flex-col items-center text-center'
>
  <TextSections section='Contacto'>
    <span slot='title'>Contáctame</span>
    <span slot='description'>
      Puedes contactarme también por correo o WhatsApp. Estoy disponible para responder cualquier
      duda sobre tu proyecto.
    </span>
  </TextSections>

  <div class='grid grid-cols-1 md:grid-cols-2 gap-6'>
    <ContactCard id='left' title='¿Prefieres escribirme directamente?'>
      <p class='text-pretty'>
        Puedes contactarme también por correo o WhatsApp. Estoy disponible para responder cualquier
        duda sobre tu proyecto.
      </p>
      <ul class='text-sm text-white/90 space-y-2 text-pretty'>
        <li><strong>Email:</strong> vicma.dev@hotmail.com</li>
        <li>
          <strong>WhatsApp:</strong>
          <a href='https://wa.me/525560908911' target='_blank' rel='noopener noreferrer'>
            +52 5560908911
          </a>
        </li>
        <li><strong>Ubicación:</strong> Puebla, México</li>
      </ul>
    </ContactCard>

    <ContactCard id='right' title='Disponibilidad y atención'>
      <p class='text-white/80 mb-2 text-pretty'>
        Respondo mensajes en el mismo día. Para reuniones o seguimiento, estos son mis horarios:
      </p>
      <ul class='text-sm text-white/90 space-y-1 text-pretty'>
        <li><strong>Lunes a Viernes:</strong> 9:00 AM – 6:00 PM</li>
        <li><strong>Sábados:</strong> 10:00 AM – 2:00 PM</li>
        <li><strong>Zona horaria:</strong> GMT-6 (CDMX)</li>
      </ul>
    </ContactCard>

    <ContactCard id='center' title='¿Tienes un proyecto en mente?' highlight>
      <p>Completa el formulario y te responderé en menos de 24 horas.</p>
      <form
        action='https://formspree.io/f/mnndzajl'
        method='POST'
        class='flex flex-col gap-4 text-sm text-white'
      >
        <input type='hidden' name='_subject' value='Nuevo Proyecto desde Freelance - VICMA' />
        <input
          type='text'
          name='_gotcha'
          style='display: none;'
          tabindex='-1'
          aria-hidden='true'
          autocomplete='off'
        />
        <input type='hidden' name='_replyto' id='replyToField' />
        <input type='hidden' name='submitted_at' id='submittedAt' />

        <div class='relative z-0 w-full group'>
          <input
            type='text'
            name='name'
            id='floating_name'
            required
            class='block py-2.5 px-0 w-full text-sm bg-transparent border-0 border-b-2 border-white/20 text-white focus:outline-none focus:ring-0 focus:border-accent peer'
            placeholder=' '
          />
          <label
            for='floating_name'
            class='peer-focus:font-medium absolute text-sm text-white/60 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:-translate-y-6 peer-focus:scale-75'
            >Tu nombre</label
          >
        </div>

        <div class='relative z-0 w-full group'>
          <input
            type='email'
            name='email'
            id='floating_email'
            required
            class='block py-2.5 px-0 w-full text-sm bg-transparent border-0 border-b-2 border-white/20 text-white focus:outline-none focus:ring-0 focus:border-accent peer'
            placeholder=' '
          />
          <label
            for='floating_email'
            class='peer-focus:font-medium absolute text-sm text-white/60 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:-translate-y-6 peer-focus:scale-75'
            >Tu correo</label
          >
        </div>

        <div class='relative z-0 w-full group'>
          <select
            name='project_type'
            id='floating_project_type'
            required
            class='block appearance-none py-2.5 px-0 w-full text-sm bg-transparent border-0 border-b-2 border-white/20 text-white focus:outline-none focus:ring-0 focus:border-accent peer font-medium'
          >
            <option value='' disabled selected hidden>Tipo de Proyecto</option>
            <option value='Landing Page'>Landing Page</option>
            <option value='Tienda Online'>Tienda Online</option>
            <option value='Blog Personal'>Blog Personal</option>
            <option value='Portafolio'>Portafolio</option>
            <option value='Otra'>Otra</option>
          </select>
        </div>

        <div id='custom-project-type' class='relative z-0 w-full group hidden'>
          <input
            type='text'
            name='custom_project_type'
            id='floating_custom_project_type'
            class='block py-2.5 px-0 w-full text-sm bg-transparent border-0 border-b-2 border-white/20 text-white focus:outline-none focus:ring-0 focus:border-accent peer'
            placeholder=' '
          />
          <label
            for='floating_custom_project_type'
            class='peer-focus:font-medium absolute text-sm text-white/60 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:-translate-y-6 peer-focus:scale-75'
            >Especifica el tipo de proyecto</label
          >
        </div>

        <div class='relative z-0 w-full group'>
          <textarea
            name='message'
            id='floating_message'
            rows='4'
            required
            class='block py-2.5 px-0 w-full text-sm bg-transparent border-0 border-b-2 border-white/20 text-white focus:outline-none focus:ring-0 focus:border-accent peer resize-none'
            placeholder=' '></textarea>
          <label
            for='floating_message'
            class='peer-focus:font-medium absolute text-sm text-white/60 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:-translate-y-6 peer-focus:scale-75'
            >Cuéntame sobre tu proyecto</label
          >
        </div>

        <button
          type='submit'
          class='mt-2 w-full py-2 px-4 bg-accent text-white font-semibold rounded-full hover:bg-accent-hover transition-colors cursor-pointer'
          >Enviar mensaje</button
        >
      </form>
    </ContactCard>

    <div
      id='success-modal'
      class='fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 hidden'
    >
      <div class='bg-white text-black rounded-2xl shadow-lg max-w-sm w-full p-6 text-center'>
        <h2 class='text-xl font-bold mb-2'>
          <span class='text-black'>¡Gracias por tu mensaje!</span>
        </h2>
        <p>
          <span class='text-gray-700'>Te responderé muy pronto.</span>
        </p>
        <button
          onclick="document.getElementById('success-modal').classList.add('hidden')"
          class='mt-4 bg-accent text-white px-4 py-2 rounded-full hover:bg-accent-hover transition cursor-pointer'
          >Cerrar</button
        >
      </div>
    </div>
  </div>
</section>

<style>
  select {
    appearance: none;
    background-color: transparent;
    color: white;
    font-weight: 500;
    border: none;
  }
  select:focus {
    outline: none;
  }
  select option {
    background-color: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 12px;
  }
  select option:hover {
    background-color: var(--color-accent-hover);
  }
  select option:checked {
    background-color: var(--color-accent);
  }
  select::-ms-expand {
    display: none;
  }
</style>

<script is:inline>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.querySelector('form')
    const replyToField = document.getElementById('replyToField')
    const emailInput = document.getElementById('floating_email')
    const submittedAt = document.getElementById('submittedAt')
    const projectType = document.getElementById('floating_project_type')
    const customField = document.getElementById('custom-project-type')
    const modal = document.getElementById('success-modal')

    projectType.addEventListener('change', () => {
      if (projectType.value === 'Otra') {
        customField.classList.remove('hidden')
        customField.querySelector('input').setAttribute('required', 'required')
      } else {
        customField.classList.add('hidden')
        customField.querySelector('input').removeAttribute('required')
      }
    })

    form.addEventListener('submit', async e => {
      e.preventDefault()

      replyToField.value = emailInput.value
      submittedAt.value = new Date().toLocaleString('es-MX', {
        timeZone: 'America/Mexico_City',
        dateStyle: 'short',
        timeStyle: 'short',
      })

      const formData = new FormData(form)

      try {
        const res = await fetch(form.action, {
          method: 'POST',
          body: formData,
          headers: { Accept: 'application/json' },
        })

        if (res.ok) {
          form.reset()
          modal.classList.remove('hidden')
        } else {
          alert('Hubo un error al enviar el mensaje.')
        }
      } catch (err) {
        alert('Error al conectar con el servicio de correo.')
      }
    })
  })
</script>
